import{r as n,aU as m,l as h,h as z,ch as M,cf as s,j as e,cc as S,br as H,ci as F,bC as C,bB as y,bq as o,ce as t,ca as L,bL as x,bg as p,cb as j,cj as d,B as V,c6 as w,ck as E}from"./d-DeYbIO6M.js";var k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M704 446H320c-4.4 0-8 3.6-8 8v402c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8V454c0-4.4-3.6-8-8-8zm-328 64h272v117H376V510zm272 290H376V683h272v117z"}},{tag:"path",attrs:{d:"M424 748a32 32 0 1064 0 32 32 0 10-64 0zm0-178a32 32 0 1064 0 32 32 0 10-64 0z"}},{tag:"path",attrs:{d:"M811.4 368.9C765.6 248 648.9 162 512.2 162S258.8 247.9 213 368.8C126.9 391.5 63.5 470.2 64 563.6 64.6 668 145.6 752.9 247.6 762c4.7.4 8.7-3.3 8.7-8v-60.4c0-4-3-7.4-7-7.9-27-3.4-52.5-15.2-72.1-34.5-24-23.5-37.2-55.1-37.2-88.6 0-28 9.1-54.4 26.2-76.4 16.7-21.4 40.2-36.9 66.1-43.7l37.9-10 13.9-36.7c8.6-22.8 20.6-44.2 35.7-63.5 14.9-19.2 32.6-36 52.4-50 41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.3c19.9 14 37.5 30.8 52.4 50 15.1 19.3 27.1 40.7 35.7 63.5l13.8 36.6 37.8 10c54.2 14.4 92.1 63.7 92.1 120 0 33.6-13.2 65.1-37.2 88.6-19.5 19.2-44.9 31.1-71.9 34.5-4 .5-6.9 3.9-6.9 7.9V754c0 4.7 4.1 8.4 8.8 8 101.7-9.2 182.5-94 183.2-198.2.6-93.4-62.7-172.1-148.6-194.9z"}}]},name:"cloud-server",theme:"outlined"},O=function(a,i){return n.createElement(m,h({},a,{ref:i,icon:k}))},$=n.forwardRef(O),B={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"},Q=function(a,i){return n.createElement(m,h({},a,{ref:i,icon:B}))},v=n.forwardRef(Q),A={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"},D=function(a,i){return n.createElement(m,h({},a,{ref:i,icon:A}))},T=n.forwardRef(D),P={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3A255.2 255.2 0 00324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3.8 2.8 1.3 4.3 1.3s3-.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM324.8 721H136V233h188.8c35.4 0 69.8 10.1 99.5 29.2l48.8 31.3 6.9 4.5v462c-47.6-25.6-100.8-39-155.2-39zm563.2 0H699.2c-54.4 0-107.6 13.4-155.2 39V298l6.9-4.5 48.8-31.3c29.7-19.1 64.1-29.2 99.5-29.2H888v488zM396.9 361H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm223.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0-4.1-3.2-7.5-7.1-7.5H627.1c-3.9 0-7.1 3.4-7.1 7.5zM396.9 501H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm416 0H627.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5z"}}]},name:"read",theme:"outlined"},W=function(a,i){return n.createElement(m,h({},a,{ref:i,icon:P}))},N=n.forwardRef(W);const U={install:"/api/install"},G={install:l=>z.post(U.install,l).then(a=>a.status!==200?new Error(a.message):a.data).catch(a=>a)},{Title:J}=M,K=()=>{const[l]=s.useForm(),a=s.useWatch("database_type",l)||"mysql",i=r=>{const f=r.database_type==="mysql"?{type:"mysql",host:r.mysql_host,port:r.mysql_port,database:r.mysql_database,username:r.mysql_username,password:r.mysql_password}:{type:"sqlite"},c={host:r.redis_host,port:r.redis_port,...r.redis_password&&{password:r.redis_password},...r.redis_database&&{database:r.redis_database}},q={username:r.username,nickname:r.nickname,email:r.email,password:r.password,url:r.url,title:r.title,database:f,redis:c};G.install(q).then(g=>{if(g instanceof Error){w.error(g.message);return}w.success("配置成功，服务器正在初始化中, 5s后将自动跳转");const u=async()=>{try{const b=Date.now();if((await fetch(`/?_t=${b}`,{method:"HEAD",cache:"no-cache",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})).ok){"caches"in window&&caches.keys().then(_=>{_.forEach(R=>caches.delete(R))});const I=Date.now();window.location.replace(`/?_refresh=${I}`)}else setTimeout(u,1e3)}catch{setTimeout(u,1e3)}};setTimeout(u,5e3)})};return e.jsx("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",background:"#f5f5f5",padding:"20px 0"},children:e.jsx(S,{style:{width:1200,borderRadius:12,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",border:"none"},styles:{body:{padding:"40px 32px"}},children:e.jsxs(H,{direction:"vertical",size:"large",style:{width:"100%",textAlign:"center"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("div",{style:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",marginBottom:16},children:e.jsx("img",{src:F,alt:"DASH Logo",style:{width:"100%",height:"100%",objectFit:"contain",userSelect:"none"}})}),e.jsx(J,{level:3,style:{margin:0,color:"#347AFF",fontWeight:"bold",userSelect:"none"},children:"DASH 安装向导"})]}),e.jsxs(s,{form:l,name:"install",onFinish:i,autoComplete:"off",layout:"vertical",size:"large",style:{width:"100%"},initialValues:{database_type:"mysql",mysql_host:"localhost",mysql_port:3306,redis_host:"localhost",redis_port:6379,redis_database:0},children:[e.jsxs(C,{gutter:24,children:[e.jsxs(y,{span:12,children:[e.jsx(o,{children:"站点信息"}),e.jsx(s.Item,{name:"url",label:"站点地址",rules:[{required:!0,type:"url",message:"请输入有效的站点地址!"}],children:e.jsx(t,{prefix:e.jsx(L,{}),placeholder:"如: https://example.com"})}),e.jsx(s.Item,{name:"title",label:"博客标题",rules:[{required:!0,message:"请输入博客标题!"}],children:e.jsx(t,{prefix:e.jsx(N,{}),placeholder:"博客标题"})}),e.jsx(o,{children:"数据库配置"}),e.jsx(s.Item,{name:"database_type",label:"数据库类型",rules:[{required:!0,message:"请选择数据库类型!"}],children:e.jsxs(x.Group,{children:[e.jsx(x,{value:"sqlite",children:"SQLite"}),e.jsx(x,{value:"mysql",children:"MySQL"})]})}),a==="mysql"&&e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:"mysql_host",label:"MySQL 主机",rules:[{required:!0,message:"请输入 MySQL 主机地址!"}],children:e.jsx(t,{prefix:e.jsx(v,{}),placeholder:"如: localhost"})}),e.jsx(s.Item,{name:"mysql_port",label:"MySQL 端口",rules:[{required:!0,message:"请输入 MySQL 端口!"}],children:e.jsx(p,{style:{width:"100%"},min:1,max:65535,placeholder:"3306"})}),e.jsx(s.Item,{name:"mysql_database",label:"数据库名",rules:[{required:!0,message:"请输入数据库名!"}],children:e.jsx(t,{prefix:e.jsx(v,{}),placeholder:"Database Name"})}),e.jsx(s.Item,{name:"mysql_username",label:"MySQL 用户名",rules:[{required:!0,message:"请输入 MySQL 用户名!"}],children:e.jsx(t,{prefix:e.jsx(j,{}),placeholder:"MySQL User"})}),e.jsx(s.Item,{name:"mysql_password",label:"MySQL 密码",children:e.jsx(t.Password,{prefix:e.jsx(d,{}),placeholder:"MySQL Password"})})]})]}),e.jsxs(y,{span:12,children:[e.jsx(o,{children:"管理员信息"}),e.jsx(s.Item,{name:"username",label:"用户名",rules:[{required:!0,message:"请输入用户名!"}],children:e.jsx(t,{prefix:e.jsx(j,{}),placeholder:"用户名"})}),e.jsx(s.Item,{name:"nickname",label:"用户昵称",rules:[{required:!0,message:"请输入用户昵称!"}],children:e.jsx(t,{prefix:e.jsx(j,{}),placeholder:"用户昵称"})}),e.jsx(s.Item,{name:"email",label:"用户邮箱",rules:[{required:!0,type:"email",message:"请输入有效的邮箱地址!"}],children:e.jsx(t,{prefix:e.jsx(T,{}),placeholder:"用户邮箱"})}),e.jsx(s.Item,{name:"password",label:"登录密码",rules:[{required:!0,message:"请输入登录密码!"},{min:8,max:100,message:"密码长度必须在8-100位之间!"}],hasFeedback:!0,children:e.jsx(t.Password,{prefix:e.jsx(d,{}),placeholder:"登录密码 (8-100位)"})}),e.jsx(s.Item,{name:"confirm_password",label:"确认登录密码",dependencies:["password"],hasFeedback:!0,rules:[{required:!0,message:"请确认您的密码!"},({getFieldValue:r})=>({validator(f,c){return!c||r("password")===c?Promise.resolve():Promise.reject(new Error("两次输入的密码不匹配!"))}})],children:e.jsx(t.Password,{prefix:e.jsx(d,{}),placeholder:"确认登录密码"})}),e.jsx(o,{children:"Redis 配置"}),e.jsx(s.Item,{name:"redis_host",label:"Redis 主机",rules:[{required:!0,message:"请输入 Redis 主机地址!"}],children:e.jsx(t,{prefix:e.jsx($,{}),placeholder:"如: localhost"})}),e.jsx(s.Item,{name:"redis_port",label:"Redis 端口",rules:[{required:!0,message:"请输入 Redis 端口!"}],children:e.jsx(p,{style:{width:"100%"},min:1,max:65535,placeholder:"6379"})}),e.jsx(s.Item,{name:"redis_password",label:"Redis 密码",children:e.jsx(t.Password,{prefix:e.jsx(d,{}),placeholder:"Redis 密码（可选）"})}),e.jsx(s.Item,{name:"redis_database",label:"Redis 数据库编号",children:e.jsx(p,{style:{width:"100%"},min:0,max:15,placeholder:"0"})})]})]}),e.jsx(s.Item,{style:{marginBottom:0,marginTop:32},children:e.jsx(V,{type:"primary",htmlType:"submit",block:!0,style:{height:48,borderRadius:8,fontSize:"16px",fontWeight:"bold",background:"linear-gradient(45deg, #347AFF, #5A8FFF)",border:"none",boxShadow:"0 4px 12px rgba(52, 122, 255, 0.3)",color:"#FFFFFF"},children:"完成安装"})})]})]})})})};function X(){const l=document.getElementById("root");E.createRoot(l).render(e.jsx(n.StrictMode,{children:e.jsx(K,{})}))}X();
